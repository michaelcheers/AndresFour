Bridge.assembly("JoelFive.LevelEditor",function($asm){"use strict";Bridge.define("JoelFive.BridgeEssentials",{statics:{methods:{LoadImage:function(value){var $t,image=($t=new Image,$t.src=value,$t),task=new System.Threading.Tasks.TaskCompletionSource;return image.onload=function(){task.setResult(image)},task.task}}}});Bridge.define("JoelFive.GameObject",{statics:{methods:{Create:function(dynamic){var $step=0,$task1,$task2,$task3,$tcs=new System.Threading.Tasks.TaskCompletionSource,result,type,character,realGameObject,drawnGameObject,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1,2,3,4,5,6,7],$step);switch($step){case 0:if(result=null,type=dynamic.type,type===JoelFive.Character.Type){$step=1;continue}else if(type===JoelFive.RealGameObject.Type){$step=3;continue}else if(type===JoelFive.DrawnGameObject.Type){$step=5;continue}$step=7;continue;case 1:character=new JoelFive.Character;$task1=character.Parse(dynamic);$step=2;$task1.continueWith($asyncBody);return;case 2:$task1.getAwaitedResult();result=character;$step=7;continue;case 3:realGameObject=new JoelFive.RealGameObject;$task2=realGameObject.Parse(dynamic);$step=4;$task2.continueWith($asyncBody);return;case 4:$task2.getAwaitedResult();result=realGameObject;$step=7;continue;case 5:drawnGameObject=new JoelFive.DrawnGameObject;$task3=drawnGameObject.Parse(dynamic);$step=6;$task3.continueWith($asyncBody);return;case 6:$task3.getAwaitedResult();result=drawnGameObject;$step=7;continue;case 7:dynamic.name!=null&&(result.Name=dynamic.name);$tcs.setResult(result);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}}},fields:{Name:null},methods:{Save:function(dynamic){dynamic.name=this.Name},AddKeys:function(addTo){addTo.add("Name","Name")},toDynamic:function(){var result={},type;if(Bridge.is(this,JoelFive.Character))type=JoelFive.Character.Type;else if(Bridge.is(this,JoelFive.RealGameObject))type=JoelFive.RealGameObject.Type;else if(Bridge.is(this,JoelFive.DrawnGameObject))type=JoelFive.DrawnGameObject.Type;else throw new System.Exception(System.String.format("Invalid type: {0}",Bridge.getType(this)));return result.type=type,this.Save(result),result}}});Bridge.define("JoelFive.Game",{statics:{methods:{Create:function(dynamic){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,children,game,$t,$t1,$t2,item,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1,2,3,4],$step);switch($step){case 0:game=($t=new JoelFive.Game,$t.Children=children=new(System.Collections.Generic.List$1(JoelFive.GameObject)),$t.Interval=dynamic.interval,$t.DrawInterval=dynamic.drawInterval,$t.Canvas=($t1=document.createElement("canvas"),$t1.width=dynamic.width,$t1.height=dynamic.height,$t1),$t.Down=new(System.Collections.Generic.HashSet$1(System.Int32).ctor),$t);$t2=Bridge.getEnumerator(Bridge.cast(dynamic.children,System.Array.type(System.Object)));$step=1;continue;case 1:if($t2.moveNext()){item=$t2.Current;$step=2;continue}$step=4;continue;case 2:$task1=JoelFive.GameObject.Create(item);$step=3;$task1.continueWith($asyncBody);return;case 3:$taskResult1=$task1.getAwaitedResult();children.add($taskResult1);$step=1;continue;case 4:$tcs.setResult(game);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}}},fields:{Children:null,Interval:0,DrawInterval:0,Canvas:null,Down:null},methods:{Start:function(){document.body.onkeyup=Bridge.fn.bind(this,$asm.$.JoelFive.Game.f1);document.body.onkeydown=Bridge.fn.bind(this,$asm.$.JoelFive.Game.f2);Bridge.global.setInterval(Bridge.fn.cacheBind(this,this.Update),this.Interval);Bridge.global.setInterval(Bridge.fn.cacheBind(this,this.Draw),this.DrawInterval)},toDynamic:function(){return{width:this.Canvas.width,height:this.Canvas.height,interval:this.Interval,drawInterval:this.DrawInterval,children:this.Children.convertAll(System.Object,$asm.$.JoelFive.Game.f3).toArray()}},Draw:function(){var $t,context=this.Canvas.getContext("2d"),child,drawObject;context.clearRect(0,0,this.Canvas.width,this.Canvas.height);$t=Bridge.getEnumerator(this.Children);try{while($t.moveNext())child=$t.Current,Bridge.is(child,JoelFive.DrawnGameObject)&&(drawObject=child,Bridge.is(drawObject.Image,System.String)?(context.fillStyle=drawObject.Image,context.fillRect(drawObject.X,drawObject.Y,drawObject.Width,drawObject.Height)):context.drawImage(drawObject.Image,drawObject.X,drawObject.Y),drawObject.Selected&&(context.strokeStyle="#4286f4",context.strokeRect(Bridge.Int.clip32(drawObject.X)-1|0,Bridge.Int.clip32(drawObject.Y)-1|0,Bridge.Int.clip32(drawObject.Width)+2|0,Bridge.Int.clip32(drawObject.Height)+2|0)))}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}},Update:function(){var $t,child;$t=Bridge.getEnumerator(this.Children);try{while($t.moveNext())child=$t.Current,Bridge.is(child,JoelFive.RealGameObject)&&child.Update(this)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}}}});Bridge.ns("JoelFive.Game",$asm.$);Bridge.apply($asm.$.JoelFive.Game,{f1:function(e){this.Down.remove(e.keyCode)},f2:function(e){this.Down.add(e.keyCode)},f3:function(v){return v.toDynamic()}});Bridge.define("JoelFive.LevelEditor.App",{main:function(){var $step=0,$task1,$taskResult1,$task2,$taskResult2,$task3,$taskResult3,start,input,file,$t,task,parseString,jsonObject,$t1,$t2,$t3,button,$t4,$asyncBody=Bridge.fn.bind(this,function(){for(;;){$step=System.Array.min([0,1,2,3],$step);switch($step){case 0:$task2=JoelFive.BridgeEssentials.LoadImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAAB3RJTUUH4QUVEx4JDRbQCAAAAzNJREFUeNrt3cFt4zAQBdCfxRbhdBHAhcSXACnDZaSCPfsYIAWkigBpYS/BAt4euAdJgOLVSCNyKJGc/wHdbIrzH2I7sBIBDMMwDMMwjH3uNA8KKU92mJS+Zh8TUhdwmNTOfirPcwDwDOABwB8AbwA+hg0QpcsNxhHAE7ruPgG8ousufvH+OATgPQBhdPwOwOPoMe4Tvh+PfUfjzt77LuP6Gi1+vll4OL4CcCLKfxinvpupzs4WIBdhcaJgFUbou5zt6YfinHOve/cAfgE4jTfoJTeznvou7meeYvIecpx4PXT/k7LyJ2N43z1avGQNb1JLJ3SDEoHxZfIhiCiLnWyHIWzANcruGMJGXKIUgyFsyBVKcRjCxlygFIshbLBplOIxhI02iVINhrDhplCqwxA23gRKtRjCAFWjVI8hDFIlSjMYwkBVoTSHIQxWBUqzGMKARaM0jyEMWiSKGwxh4KJQ3GEIgxeB4hZDKGBXFPcYQhG7oBBjvpBNUYihK2YTFGKsKygrCjHiisqCQoyVyYlCjMjkQCFGYixRiGEUCxRiGMcQhRhWMUAhhnUSUIiRKxEof/uDGLkSgUKM3DFCIYZlElGIkSMTH2uvCoxrKOQyozXR/BVuiUn+tyFMZCJ+6cvyJReDZAyiWMYIgygWicC4Kt7oiRKTCIzho22Wbx5dJwGjiOu+mooBBlGsYohBlNRYYAhrEWVtLDGENYmiTQ4MYW2iLCUnhnAOoiiLyvq1K1HWFbTJd+BE0RWz6QUJRJkvZJerQ4gyXcSul+q4RykJQ9iTH5QSMYS9tY9SMoawx3ZRasAQ9toeSk0Ywp7bQakRQ9h7/Sg1Ywgz1IvSAoYwS30oLWEIM9WD0iKGMFv5KC1jCDOWi+IBQ5i1PBRPGMLM5aB4xBBm3x/FM4bQwX4oxBC72B6FGIudbIdCDHU326CMnqy9saQLjIl+tChmN5Z8IcZiR1qUFwuQCzFUPWlQLhYgZ2Kou1pCOVuA8Ab3ikygRN3g/m7pJH0OAJ4BPKC7BfUbgA/VIo5yU/QRwBO67j4BvKK/ffdcX1qQuAUcJrUzVZ8h5ckOw74YhmEYhmFKyz+CH5J6R0WlaQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNy0wNS0yMVQxOTozMDowOSswMDowME2eJS8AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTctMDUtMjFUMTk6MzA6MDkrMDA6MDA8w52TAAAAAElFTkSuQmCC");$step=1;$task2.continueWith($asyncBody,!0);return;case 1:$taskResult2=$task2.getAwaitedResult();JoelFive.LevelEditor.App.cross=$taskResult2;JoelFive.LevelEditor.App.cross.width=10;JoelFive.LevelEditor.App.cross.height=10;start=document.createElement("div");input=document.createElement("input");file=($t=document.createElement("input"),$t.type="file",$t);start.appendChild(input);start.appendChild(document.createTextNode(" or"));start.appendChild(document.createElement("br"));start.appendChild(file);document.body.appendChild(start);task=new System.Threading.Tasks.TaskCompletionSource;input.oninput=function(){task.setResult(input.value)};file.onchange=function(){var $step=0,$task1,$taskResult1,e,$asyncBody=Bridge.fn.bind(this,function(){for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:$task1=JoelFive.LevelEditor.App.FileRead(file);$step=1;$task1.continueWith($asyncBody,!0);return;case 1:$taskResult1=$task1.getAwaitedResult();task.setResult($taskResult1);return;default:return}}},arguments);$asyncBody()};$task1=task.task;$step=2;$task1.continueWith($asyncBody,!0);return;case 2:$taskResult1=$task1.getAwaitedResult();parseString=Bridge.global.atob($taskResult1);jsonObject=JSON.parse(parseString);JoelFive.LevelEditor.App.creation=jsonObject;start.style.display="none";$task3=JoelFive.Game.Create(jsonObject);$step=3;$task3.continueWith($asyncBody,!0);return;case 3:$taskResult3=$task3.getAwaitedResult();JoelFive.LevelEditor.App.game=$taskResult3;JoelFive.LevelEditor.App.game.Canvas.style.border="1px solid black";document.body.appendChild(($t1=document.createElement("div"),JoelFive.LevelEditor.App.left=$t1,$t1));document.body.appendChild(($t2=document.createElement("div"),JoelFive.LevelEditor.App.right=$t2,$t2));JoelFive.LevelEditor.App.right.appendChild(($t3=document.createElement("table"),JoelFive.LevelEditor.App.table=$t3,$t3));JoelFive.LevelEditor.App.left.style.width="50%";JoelFive.LevelEditor.App.right.style.width="50%";JoelFive.LevelEditor.App.left.style.cssFloat="left";JoelFive.LevelEditor.App.right.style.cssFloat="right";JoelFive.LevelEditor.App.left.appendChild(JoelFive.LevelEditor.App.game.Canvas);button=($t4=document.createElement("button"),$t4.innerHTML="Save",$t4.onclick=$asm.$.JoelFive.LevelEditor.App.f1,$t4);button.style.position="fixed";button.style.bottom="0";button.style.left="0";document.body.appendChild(button);JoelFive.LevelEditor.App.Reload();return;default:return}}},arguments);$asyncBody()},statics:{fields:{game:null,left:null,right:null,table:null,creation:null,selected:null,cross:null},methods:{Save:function(){var $t,dynamicVal=JoelFive.LevelEditor.App.game.toDynamic(),download;dynamicVal.recovery=JoelFive.LevelEditor.App.creation;download=($t=document.createElement("a"),$t.download="level.dat",$t.href=System.String.format("data:text/plain;charset=UTF-8,{0}",Bridge.global.btoa(JSON.stringify(dynamicVal))),$t);download.click()},FileRead:function(fileInput){var file=fileInput.files[System.Array.index(0,fileInput.files)],fileReader=new FileReader,task=new System.Threading.Tasks.TaskCompletionSource;return fileReader.onload=function(){task.setResult(fileReader.result)},fileReader.readAsText(file),task.task},Remove:function(gameObject){if(!JoelFive.LevelEditor.App.game.Children.remove(gameObject))throw new System.Exception;JoelFive.LevelEditor.App.Reload()},Reload:function(){var $t,$t1,$t2,$t3,$t4,$t5,row1,cell1;JoelFive.LevelEditor.App.table.innerHTML="";row1=document.createElement("tr");JoelFive.LevelEditor.App.table.appendChild(row1);cell1=document.createElement("td");cell1.appendChild(($t=document.createElement("a"),$t.href="javascript:void(0)",$t.onclick=$asm.$.JoelFive.LevelEditor.App.f2,$t.innerHTML="Unselect",$t));row1.appendChild(cell1);$t1=Bridge.getEnumerator(JoelFive.LevelEditor.App.game.Children);try{while($t1.moveNext())$t2=function(){var gameObject=$t1.Current,row,cell,cross,text;if(System.String.isNullOrEmpty(gameObject.Name))return{jump:1};if(row=document.createElement("tr"),cell=document.createElement("td"),cell.style.borderBottom="1px solid black",cell.appendChild(($t3=document.createElement("a"),$t3.innerHTML=gameObject.Name,$t3.href="javascript:void(0)",$t3.onclick=function(){JoelFive.LevelEditor.App.Select(gameObject)},$t3)),cell.appendChild(document.createTextNode(" ")),cross=($t4=document.createElement("a"),$t4.onclick=function(){JoelFive.LevelEditor.App.Remove(gameObject)},$t4.href="javascript:void(0)",$t4),cross.appendChild(($t5=JoelFive.LevelEditor.App.cross.cloneNode(),JoelFive.LevelEditor.App.cross=$t5,$t5)),cell.appendChild(cross),cell.appendChild(document.createElement("br")),Bridge.is(gameObject,JoelFive.Character))text="Character";else if(Bridge.is(gameObject,JoelFive.RealGameObject))text="Real Thing";else if(Bridge.is(gameObject,JoelFive.DrawnGameObject))text="Illusion";else throw new System.Exception(System.String.format("Type not allowed: {0}",Bridge.Reflection.getTypeFullName(Bridge.getType(gameObject))));cell.appendChild(document.createTextNode(System.String.format("Type: {0}",text)));row.appendChild(cell);JoelFive.LevelEditor.App.table.appendChild(row)}.call(this)||{},$t2.jump==1}finally{Bridge.is($t1,System.IDisposable)&&$t1.System$IDisposable$dispose()}JoelFive.LevelEditor.App.game.Draw()},Select:function(gameObject){Bridge.is(JoelFive.LevelEditor.App.selected,JoelFive.DrawnGameObject)&&(JoelFive.LevelEditor.App.selected.Selected=!1);Bridge.is((JoelFive.LevelEditor.App.selected=gameObject,gameObject),JoelFive.DrawnGameObject)&&(gameObject.Selected=!0);JoelFive.LevelEditor.App.Reload()}}}});Bridge.ns("JoelFive.LevelEditor.App",$asm.$);Bridge.apply($asm.$.JoelFive.LevelEditor.App,{f1:function(){JoelFive.LevelEditor.App.Save()},f2:function(){JoelFive.LevelEditor.App.Select(null)}});Bridge.define("JoelFive.Movement",{fields:{Velocity:null,Keys:null},ctors:{init:function(){this.Velocity=new JoelFive.Vector2}}});Bridge.define("JoelFive.Rectangle",{$kind:"struct",statics:{methods:{getDefaultValue:function(){return new JoelFive.Rectangle}}},fields:{X:0,Y:0,_width:0,_height:0},props:{Width:{get:function(){return this._width},set:function(value){value<0&&(this.X-=value,value=-value);this._width=value}},Height:{get:function(){return this._height},set:function(value){value<0&&(this.Y-=value,value=-value);this._height=value}}},ctors:{ctor:function(){this.$initialize()}},methods:{Intersects:function(value){return value.X<this.X+this.Width&&this.X<value.X+value.Width&&value.Y<this.Y+this.Height&&this.Y<value.Y+value.Height},getHashCode:function(){return Bridge.addHash([3771388952,this.X,this.Y,this._width,this._height])},equals:function(o){return Bridge.is(o,JoelFive.Rectangle)?Bridge.equals(this.X,o.X)&&Bridge.equals(this.Y,o.Y)&&Bridge.equals(this._width,o._width)&&Bridge.equals(this._height,o._height):!1},$clone:function(to){var s=to||new JoelFive.Rectangle;return s.X=this.X,s.Y=this.Y,s._width=this._width,s._height=this._height,s}}});Bridge.define("JoelFive.Vector2",{$kind:"struct",statics:{methods:{getDefaultValue:function(){return new JoelFive.Vector2}}},fields:{X:0,Y:0},ctors:{ctor:function(){this.$initialize()}},methods:{getHashCode:function(){return Bridge.addHash([1955977157,this.X,this.Y])},equals:function(o){return Bridge.is(o,JoelFive.Vector2)?Bridge.equals(this.X,o.X)&&Bridge.equals(this.Y,o.Y):!1},$clone:function(to){var s=to||new JoelFive.Vector2;return s.X=this.X,s.Y=this.Y,s}}});Bridge.define("JoelFive.DrawnGameObject",{inherits:[JoelFive.GameObject],statics:{fields:{Type:null},ctors:{init:function(){this.Type="drawn game object"}}},fields:{Selected:!1,Position:null,Image:null},props:{X:{get:function(){return this.Position.X},set:function(value){this.Position.X=value}},Y:{get:function(){return this.Position.Y},set:function(value){this.Position.Y=value}},Width:{get:function(){return this.Position.Width},set:function(value){this.Position.Width=value}},Height:{get:function(){return this.Position.Height},set:function(value){this.Position.Height=value}}},ctors:{init:function(){this.Position=new JoelFive.Rectangle}},methods:{Save:function(dynamic){dynamic.x=this.X;dynamic.y=this.Y;dynamic.width=this.Width;dynamic.height=this.Height;dynamic.image=Bridge.is(this.Image,HTMLImageElement)?this.Image.src:this.Image;JoelFive.GameObject.prototype.Save.call(this,dynamic)},Parse:function(dynamic){var $step=0,$task1,$taskResult1,$tcs=new System.Threading.Tasks.TaskCompletionSource,imageString,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1,2,3,4],$step);switch($step){case 0:if(this.X=dynamic.x,this.Y=dynamic.y,this.Width=dynamic.width,this.Height=dynamic.height,imageString=dynamic.image,imageString.charCodeAt(0)===35){$step=1;continue}else{$step=2;continue}case 1:this.Image=imageString;$step=4;continue;case 2:$task1=JoelFive.BridgeEssentials.LoadImage(imageString);$step=3;$task1.continueWith($asyncBody);return;case 3:$taskResult1=$task1.getAwaitedResult();this.Image=$taskResult1;$step=4;continue;case 4:$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}}});Bridge.define("JoelFive.RealGameObject",{inherits:[JoelFive.DrawnGameObject],statics:{fields:{Type:null},ctors:{init:function(){this.Type="real game object"}}},fields:{Gravity:0,onSolid:!1},methods:{Save:function(dynamic){dynamic.gravity=this.Gravity;JoelFive.DrawnGameObject.prototype.Save.call(this,dynamic)},Parse:function(dynamic){var $step=0,$task1,$tcs=new System.Threading.Tasks.TaskCompletionSource,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:this.Gravity=dynamic.gravity;$task1=JoelFive.DrawnGameObject.prototype.Parse.call(this,dynamic);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task},TryMove$1:function($in,NotMovingIn,MovingIn,NotMovingInLength,MovingInLength,Velocity,GetMovingIn,GetMovingInLength){var $t,$t1,$t2,intersects,child,realGameObject,rect,doesIntersect,min;if(Velocity<0)return this.TryMoveNegative($in,NotMovingIn,MovingIn,NotMovingInLength,MovingInLength,-Velocity,GetMovingIn,GetMovingInLength);intersects=new(System.Collections.Generic.List$1(JoelFive.RealGameObject));$t=Bridge.getEnumerator($in.Children);try{while($t.moveNext())if(child=$t.Current,Bridge.is(child,JoelFive.RealGameObject)){if(realGameObject=child,rect=($t1=new JoelFive.Rectangle,$t1.X=NotMovingIn,$t1.Width=NotMovingInLength,$t1.Y=MovingIn.v+MovingInLength,$t1.Height=Velocity,$t1),GetMovingIn(rect.$clone())===rect.X&&GetMovingInLength(rect.$clone())===rect.Width){var newX=rect.Y,newY=rect.X,newWidth=rect.Height,newHeight=rect.Width;rect=($t2=new JoelFive.Rectangle,$t2.X=newX,$t2.Y=newY,$t2.Width=newWidth,$t2.Height=newHeight,$t2)}doesIntersect=rect.Intersects(realGameObject.Position.$clone());doesIntersect&&intersects.add(realGameObject)}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}if(intersects.Count===0)MovingIn.v+=Velocity;else return min=System.Linq.Enumerable.from(intersects).min(function(v){return GetMovingIn(v.Position.$clone())-MovingInLength}),MovingIn.v=min,!1;return!0},TryMove:function($in,velocity){var $t,$t1,canMove;return velocity.X!==0&&velocity.Y!==0?(canMove=!0,canMove=this.TryMove($in,($t=new JoelFive.Vector2,$t.X=velocity.X,$t))?canMove:!1,this.TryMove($in,($t1=new JoelFive.Vector2,$t1.Y=velocity.Y,$t1))?canMove:!1):velocity.X!==0?this.TryMove$1($in,this.Position.Y,Bridge.ref(this.Position,"X"),this.Position.Height,this.Position.Width,velocity.X,$asm.$.JoelFive.RealGameObject.f1,$asm.$.JoelFive.RealGameObject.f2):velocity.Y!==0?this.TryMove$1($in,this.Position.X,Bridge.ref(this.Position,"Y"),this.Position.Width,this.Position.Height,velocity.Y,$asm.$.JoelFive.RealGameObject.f3,$asm.$.JoelFive.RealGameObject.f4):!0},TryMoveNegative:function($in,NotMovingIn,MovingIn,NotMovingInLength,MovingInLength,Velocity,GetMovingIn,GetMovingInLength){var $t,$t1,$t2,intersects=new(System.Collections.Generic.List$1(JoelFive.RealGameObject)),child,realGameObject,rect,doesIntersect,max;$t=Bridge.getEnumerator($in.Children);try{while($t.moveNext())if(child=$t.Current,Bridge.is(child,JoelFive.RealGameObject)){if(realGameObject=child,rect=($t1=new JoelFive.Rectangle,$t1.X=NotMovingIn,$t1.Width=NotMovingInLength,$t1.Y=MovingIn.v-Velocity,$t1.Height=Velocity,$t1),GetMovingIn(rect.$clone())===rect.X&&GetMovingInLength(rect.$clone())===rect.Width){var newX=rect.Y,newY=rect.X,newWidth=rect.Height,newHeight=rect.Width;rect=($t2=new JoelFive.Rectangle,$t2.X=newX,$t2.Y=newY,$t2.Width=newWidth,$t2.Height=newHeight,$t2)}doesIntersect=rect.Intersects(realGameObject.Position.$clone());doesIntersect&&intersects.add(realGameObject)}}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}if(intersects.Count===0)MovingIn.v-=Velocity;else return max=System.Linq.Enumerable.from(intersects).max(function(v){return GetMovingIn(v.Position.$clone())+GetMovingInLength(v.Position.$clone())}),MovingIn.v=max,!1;return!0},Update:function($in){var $t;this.onSolid=!this.TryMove($in,($t=new JoelFive.Vector2,$t.Y=this.Gravity,$t))}}});Bridge.ns("JoelFive.RealGameObject",$asm.$);Bridge.apply($asm.$.JoelFive.RealGameObject,{f1:function(v){return v.X},f2:function(v){return v.Width},f3:function(v){return v.Y},f4:function(v){return v.Height}});Bridge.define("JoelFive.Character",{inherits:[JoelFive.RealGameObject],statics:{fields:{Type:null},ctors:{init:function(){this.Type="character"}}},fields:{movements:null},methods:{Save:function(dynamic){dynamic.movements=this.movements.convertAll(System.Object,$asm.$.JoelFive.Character.f1).toArray();JoelFive.RealGameObject.prototype.Save.call(this,dynamic)},Update:function($in){var $t,$t1;if(JoelFive.RealGameObject.prototype.Update.call(this,$in),this.onSolid){$t=Bridge.getEnumerator(this.movements);try{while($t.moveNext())if($t1=function(){var movement=$t.Current;if(System.Linq.Enumerable.from(movement.Keys).all(function(key){return $in.Down.contains(key)}))return this.TryMove($in,movement.Velocity.$clone()),{jump:2}}.call(this)||{},$t1.jump==2)break}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}}},Parse:function(dynamic){var $step=0,$task1,$tcs=new System.Threading.Tasks.TaskCompletionSource,$t,movementDynamic,movement,$t1,$t2,$async_e,$asyncBody=Bridge.fn.bind(this,function(){try{for(;;){$step=System.Array.min([0,1],$step);switch($step){case 0:this.movements=new(System.Collections.Generic.List$1(JoelFive.Movement));$t=Bridge.getEnumerator(dynamic.movements);try{while($t.moveNext())movementDynamic=$t.Current,movement=($t1=new JoelFive.Movement,$t1.Velocity=($t2=new JoelFive.Vector2,$t2.X=movementDynamic.x,$t2.Y=movementDynamic.y,$t2),$t1.Keys=System.Linq.Enumerable.from(Bridge.cast(movementDynamic.keys,System.Array.type(System.Int32))).toList(System.Int32),$t1),this.movements.add(movement)}finally{Bridge.is($t,System.IDisposable)&&$t.System$IDisposable$dispose()}$task1=JoelFive.RealGameObject.prototype.Parse.call(this,dynamic);$step=1;$task1.continueWith($asyncBody);return;case 1:$task1.getAwaitedResult();$tcs.setResult(null);return;default:$tcs.setResult(null);return}}}catch($async_e1){$async_e=System.Exception.create($async_e1);$tcs.setException($async_e)}},arguments);return $asyncBody(),$tcs.task}}});Bridge.ns("JoelFive.Character",$asm.$);Bridge.apply($asm.$.JoelFive.Character,{f1:function(v){return{keys:v.Keys.toArray(),x:v.Velocity.X,y:v.Velocity.Y}}})});